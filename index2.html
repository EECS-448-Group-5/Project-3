<html>
    <head>
        <script type="module">

    // import kaboom lib
    import kaboom from "https://unpkg.com/kaboom/dist/kaboom.mjs";
    import * as util from "./util.js";
    
    // initialize kaboom context
    kaboom({width: 1920, height: 1080});

    loadSprite("background", "sprites/background.jpg");
    loadSprite("BattlePlatform", "sprites/BattlePlatform.png");
    loadSprite("EmptyHealthbar", "sprites/EmptyHealthbar.png");
    loadSprite("HealthBackground", "sprites/HealthBackground.png");
    loadSprite("HealthBarSection", "sprites/HealthBarSection.png");
    loadSprite("player1", "sprites/player1.png");
    loadSprite("Textbox", "sprites/Textbox.png");

    onKeyPress("f", (c) => {
        fullscreen(!isFullscreen())
}   )

    let inputQueue = new util.Queue();
    onClick(()=>{
        if(!inputQueue.isEmpty){
            inputQueue.dequeue()();//why does this look so cursed?
        }

    })

    //add properties & change numbers as necessary
    let player = {
        hp: 100,
        atk: 10,
        def: 10,
        spAtk: 10,
        spDef: 10,
        statuses: [],
        moves: [
            {
                name: "Punch",
                desc: "punch him",
                func: ()=>{console.log("punch"); return "ow"},
                pretext: "You punch him"
            },
            {
                name: "Punch",
                desc: "punch him",
                func: ()=>{console.log("punch"); return "ow"},
                pretext: "You punch him"
            },
            {
                name: "Punch",
                desc: "punch him",
                func: ()=>{console.log("punch"); return "ow"},
                pretext: "You punch him"
            },
            {
                name: "Punch",
                desc: "punch him",
                func: ()=>{console.log("punch"); return "ow"},
                pretext: "You punch him"
            }
        ]
    };

    let enemy = {
        hp: 100,
        statuses: [],
        die: ()=>{

        },

        getFlavor: ()=>{
            return "Mitchell hasn't implemented this yet.";
        }


    }

    const background = add([
        sprite("background"),
        pos(0,0),
    ])

    player.gameObj = add([
        sprite("player1"),
        util.propPos(.2, .45),//pos(width()/2 - 50, height()/2 - 50),
        origin("center"),
        scale(.5),
        z(10)
    ])

    window.player = player;

    enemy.gameObj = add([
        sprite("player1"),
        util.propPos(.8, .15),
        origin("center"),
        scale(.5),
        z(10)
    ])

    //util.scaleToProp(enemy, -1, .25)

    const player_platform = add([
        sprite("BattlePlatform"),
        util.propPos(.2, .6),
        origin("center"),
        scale(.5)
    ]);

    const enemy_platform = add([
        sprite("BattlePlatform"),
        util.propPos(.8, .3),
        origin("center"),
        scale(.5)
    ])


    const textBox = add([
        sprite("Textbox"),
        util.propPos(0, .7),
        scale(1)
    ])
    util.scaleToProp(textBox, 1, .3);




    const playerHPBG = add([
        sprite("HealthBackground"),
        util.propPos(.45, .45),
        origin("center"),
        scale(1)
    ])
    util.scaleToProp(playerHPBG, .3, .25);

    const playerHealth = add([
        sprite("HealthBarSection"),
        util.propPos(.35, .375),
        origin("topleft"),
        scale(1)
    ])
    util.scaleToProp(playerHealth, .225, .05)

    window.hp = playerHealth

    const playerHPFacade = add([
        sprite("EmptyHealthbar"),
        util.propPos(.45, .4),
        origin("center"),
        scale(1)
    ])
    util.scaleToProp(playerHPFacade, .25, -1)

    



    const enemyHPBG = add([
        sprite("HealthBackground"),
        util.propPos(.55, .15),
        origin("center"),
        scale(1)
    ])
    util.scaleToProp(enemyHPBG, .3, .25);

    const enemyHealth = add([
        sprite("HealthBarSection"),
        util.propPos(.45, .075),
        origin("topleft"),
        scale(1)
    ])
    util.scaleToProp(enemyHealth, .225, .05)

    const enemyHPFacade = add([
        sprite("EmptyHealthbar"),
        util.propPos(.55, .1),
        origin("center"),
        scale(1)
    ])
    util.scaleToProp(enemyHPFacade, .25, -1)





    function drawMoveSelection(){
        let move1 = drawMove(.15, .8, player.moves[0]); 
        let move2 = drawMove(.3, .8, player.moves[1]);
        let move3 = drawMove(.15, .9, player.moves[2]);
        let move4 = drawMove(.3, .9, player.moves[3]);
    }

    function drawMove(x, y, move){
        let moveText = add([
            text(move.name),
            origin("center"),
            util.propPos(x, y),
            area({ cursor: "pointer", }),
            scale(1)
        ])
        moveText.onClick(()=>{if(inputQueue.isEmpty) playerMove(move)});
        moveText.onHover(()=>{
            if(inputQueue.isEmpty)
                printDescriptionText(move.desc);
        });
        return moveText;
    }

    window.currentDescText = null
    function printDescriptionText(desc){
        if(!window.currentDescText){
            window.currentDescText = add([
                text(desc, {
                    width: width()*.6
                }),
                util.propPos(.7, .85),
                origin("center"),
                scale(1)
            ]);
            onMouseMove(()=>{if(inputQueue.isEmpty) window.currentDescText.text = enemy.getFlavor();});
        }

        window.currentDescText.text = desc;

        
    }

    function playerMove(move){
        inputQueue.enqueue(()=>{
            printDescriptionText(move.pretext);
        });
        inputQueue.enqueue(()=>{
            printDescriptionText(move.func());
        });
        inputQueue.enqueue(()=>{
            printDescriptionText(enemy.getFlavor());
        });

        inputQueue.dequeue()();

    }

    drawMoveSelection();




    



    
    
        </script>
    </head>
</html>